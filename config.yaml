mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
external-controller: :9090

dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053
  enhanced-mode: redir-host

  nameserver:
    - 223.5.5.5
    - 119.29.29.29

  nameserver-policy:
    'e.szridge.com': [10.0.0.1, 10.0.0.200]
    '*.szridge.com': [10.0.0.1, 10.0.0.200]

proxies:
  - name: "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
    type: vmess
    server: 45.62.126.254           # å¡« IP
    port: 2082               # å¡«ç«¯å£
    uuid: "93f5c691-ad0c-401c-ad36-4b6f1c65a92d"    # å¡« UUID
    alterId: 0
    cipher: auto
    udp: true
    # å¦‚æœæ˜¯ WebSocket (ws) åè®®ï¼Œé€šå¸¸è¿˜éœ€è¦ä¸‹é¢è¿™äº›ï¼Œä¸æ˜¯åˆ™åˆ é™¤
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: ""
        
proxy-providers:
  ProviderA:
    type: http
    url: https://raw.githubusercontent.com/arronnrock/clash-dist/main/providers/providerA.yaml?v=20888173346
    interval: 3600
    #path: ./providers/providerA.yaml
    #health-check:
      #enable: true
      #interval: 600
      #url: http://www.gstatic.com/generate_204

  ProviderB:
    type: http
    url: https://raw.githubusercontent.com/arronnrock/clash-dist/main/providers/providerB.yaml?v=20888173346
    interval: 3600
    #path: ./providers/providerB.yaml
    #health-check:
      #enable: true
      #interval: 600
      #url: http://www.gstatic.com/generate_204

proxy-groups:
  ##########################################################
  # 1. æ ¸å¿ƒåœ°åŒºå…¥å£ (æç®€æ‰å¹³åŒ–è®¾è®¡)
  # ç›´æ¥ç­›é€‰ Provider å†…å®¹ï¼Œä¸å»ºç«‹ä¸­é—´ç»„
  ##########################################################
  
  # US: è¿½æ±‚é€Ÿåº¦ï¼Œä½¿ç”¨ url-test è‡ªåŠ¨æ‹©ä¼˜
  # åŒ…å«: A-BiggerBOX + ProviderA(US) + ProviderB(US)
  - name: US
    type: url-test
    proxies:
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
    use:
      - ProviderA
      - ProviderB
    # ç­›é€‰æ‰€æœ‰å¸¦ US/ç¾å›½ ç­‰å…³é”®è¯ï¼Œä»¥åŠJMSçš„ s1-s3
    filter: "(?i)(@c87s(1|2|3)\\b|\\bUS\\b|USA|United\\s*States|ç¾å›½|æ´›æ‰çŸ¶|åœ£ä½•å¡|è¥¿é›…å›¾|è¾¾æ‹‰æ–¯|çº½çº¦)"
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50

  # HK: è¿½æ±‚ç¨³å®šä¸ä¹±è·³ï¼Œä½¿ç”¨ fallback (æ•…éšœè½¬ç§»)
  # åªè¦æ’åœ¨å‰é¢çš„èŠ‚ç‚¹æ˜¯å¥½çš„ï¼Œå°±ä¸€ç›´ç”¨å®ƒ
  - name: HK
    type: fallback
    use:
      - ProviderB
    filter: "(?i)(\\bHK\\b|Hong\\s*Kong|é¦™æ¸¯)"
    url: http://www.gstatic.com/generate_204
    interval: 300

  # JP: è¿½æ±‚ç¨³å®šï¼Œä½¿ç”¨ fallback
  - name: JP
    type: fallback
    use:
      - ProviderA
      - ProviderB
    filter: "(?i)(@c87s4\\b|\\bJP\\b|Japan|æ—¥æœ¬|ä¸œäº¬|å¤§é˜ª|åŸ¼ç‰)"
    url: http://www.gstatic.com/generate_204
    interval: 300

  # SG: è¿½æ±‚ç¨³å®šï¼Œä½¿ç”¨ fallback
  - name: SG
    type: fallback
    use:
      - ProviderB
    filter: "(?i)(\\bSG\\b|Singapore|æ–°åŠ å¡)"
    url: http://www.gstatic.com/generate_204
    interval: 300

  ##########################################################
  # 2. é£é™©æ§åˆ¶ä¸æ‰‹åŠ¨å›ºå®š (PIN)
  ##########################################################
  
  # è¿™é‡Œçš„èŠ‚ç‚¹å®Œå…¨æ‰‹åŠ¨é€‰æ‹©ï¼Œç”¨äº AI/PayPal å…»å·
  # åŒ…å«äº† A-BiggerBOX å’Œæ‰€æœ‰ US èŠ‚ç‚¹
  - name: US-PIN
    type: select
    proxies:
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
    use:
      - ProviderA
      - ProviderB
    filter: "(?i)(@c87s(1|2|3)\\b|\\bUS\\b|USA|United\\s*States|ç¾å›½)"

  # AI ä¸“ç”¨å…¥å£
  - name: AI-PIN
    type: select
    proxies:
      - US-PIN
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX" 
      - DIRECT

  # Apple Private Relay ä¸“ç”¨
  - name: AppleAI-PIN
    type: select
    proxies:
      - US-PIN
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
      - DIRECT

  ##########################################################
  # 3. ä¸šåŠ¡ç­–ç•¥ (ç²¾ç®€)
  ##########################################################

  # åªæœ‰åœ¨ AI/US-PIN æ— æ³•æ»¡è¶³æ—¶ï¼Œæ‰éœ€è¦åŠ¨è¿™ä¸ª
  # æ—¥å¸¸è¿™é‡Œé€‰ "Auto" æˆ–è€… "US" å³å¯
  - name: Proxies
    type: select
    proxies:
      - Auto
      - US
      - HK
      - JP
      - SG
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
      - DIRECT

  # å…¨å±€è‡ªåŠ¨æµ‹é€Ÿ (æ‰€æœ‰èŠ‚ç‚¹å‚ä¸)
  - name: Auto
    type: url-test
    proxies:
      - "ğŸ‡ºğŸ‡¸ A-BiggerBOX"
    use:
      - ProviderA
      - ProviderB
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 80

  # ç¤¾äº¤è½¯ä»¶ï¼šä¼˜å…ˆèµ° HK (ä½å»¶è¿Ÿ)ï¼ŒæŒ‚äº†è‡ªåŠ¨åˆ‡ SG/US
  - name: Telegram
    type: select
    proxies:
      - HK
      - SG
      - US
      - Proxies

  - name: WhatsApp
    type: select
    proxies:
      - HK
      - SG
      - US
      - Proxies

  # è§†é¢‘ï¼šä¼˜å…ˆ US (å¸¦å®½å¤§)ï¼Œæ‰‹åŠ¨å¯é€‰ HK
  - name: YouTube
    type: select
    proxies:
      - US
      - HK
      - Proxies

  # AI æœåŠ¡ï¼šå¼ºåˆ¶èµ° PIN ç»„
  - name: AI
    type: select
    proxies:
      - AI-PIN
      - US-PIN
      - Proxies

  - name: Google
    type: select
    proxies:
      - US
      - HK
      - JP
      - Proxies

  - name: Apple
    type: select
    proxies:
      - Proxies
      - US
      - DIRECT

  - name: PayPal
    type: select
    proxies:
      - US-PIN
      - DIRECT

  - name: NSFW
    type: select
    proxies:
      - US
      - Proxies

rules:
  # --- å…¬å¸å†…ç½‘ ---
  - DOMAIN,e.szridge.com,DIRECT
  - DOMAIN-SUFFIX,szridge.com,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve

  # --- Apple Intelligence / Private Relay (å¼ºåˆ¶ US-PIN) ---
  - DOMAIN-SUFFIX,mask.icloud.com,AppleAI-PIN
  - DOMAIN-SUFFIX,mask-h2.icloud.com,AppleAI-PIN
  - DOMAIN-SUFFIX,mask-api.icloud.com,AppleAI-PIN
  - DOMAIN-SUFFIX,guzzoni.apple.com,AppleAI-PIN
  - DOMAIN-SUFFIX,smoot.apple.com,AppleAI-PIN
  - DOMAIN-SUFFIX,apple-relay.apple.com,AppleAI-PIN
  - DOMAIN-SUFFIX,apple-relay.akamaized.net,AppleAI-PIN
  - DOMAIN-SUFFIX,apple-relay.cloudflare.com,AppleAI-PIN
  
  # --- AI (ChatGPT / Gemini / Claude) ---
  - DOMAIN-SUFFIX,openai.com,AI
  - DOMAIN-SUFFIX,chatgpt.com,AI
  - DOMAIN-SUFFIX,oaistatic.com,AI
  - DOMAIN-SUFFIX,cdn.openai.com,AI
  - DOMAIN-SUFFIX,anthropic.com,AI
  - DOMAIN-SUFFIX,claude.ai,AI
  - DOMAIN,gemini.google.com,AI
  - DOMAIN,bard.google.com,AI
  - DOMAIN,proactivebackend-pa.googleapis.com,AI
  - DOMAIN,generativelanguage.googleapis.com,AI
  
  # --- IM (Telegram / WhatsApp) ---
  - DOMAIN-SUFFIX,t.me,Telegram
  - DOMAIN-SUFFIX,telegram.org,Telegram
  - IP-CIDR,91.108.0.0/16,Telegram,no-resolve
  - DOMAIN-SUFFIX,whatsapp.com,WhatsApp
  - DOMAIN-SUFFIX,whatsapp.net,WhatsApp
  - DOMAIN,wa.me,WhatsApp

  # --- Media / Other ---
  - DOMAIN-SUFFIX,youtube.com,YouTube
  - DOMAIN-SUFFIX,youtu.be,YouTube
  - DOMAIN-SUFFIX,googlevideo.com,YouTube
  - DOMAIN-SUFFIX,pikpak.com,NSFW
  - DOMAIN-SUFFIX,pornhub.com,NSFW
  - DOMAIN-SUFFIX,paypal.com,PayPal
  
  # --- Google General ---
  - DOMAIN-SUFFIX,google.com,Google
  - DOMAIN-SUFFIX,googleapis.com,Google
  - DOMAIN-SUFFIX,gstatic.com,Google

  # --- Final ---
  - GEOIP,CN,DIRECT
  - MATCH,Proxies
